log-pipeline:
  source:
    otel_logs_source:
      port: 21892
      ssl: false

  sink:
    - opensearch:
        hosts:
          - "http://opensearch:9200"
        index: "logs-${serviceName}-%{yyyy.MM.dd}"
        # 서비스 별로 인덱스 생성 (serviceName 변수 사용)

trace-pipeline:
  source:
    otel_trace_source:
      port: 21890
      ssl: false

  processor:
    - otel_traces:
        # trace 데이터 처리를 위한 기본 설정
        trace_flush_interval: 180

  sink:
    - opensearch:
        # (첫 번째 목적지) 처리된 스팬 데이터를 저장할 OpenSearch 정보
        hosts:
          - "http://opensearch:9200"
        index: "otel-v1-apm-span-%{yyyy.MM.dd}"
    - pipeline:
        # (두 번째 목적지) 아래에 정의된 'service-map-pipeline'으로 데이터를 보냅니다.
        name: "service-map-pipeline"

service-map-pipeline:
  source:
    pipeline:
      name: "trace-pipeline"

  processor:
    - service_map:
        # service_map 프로세서 설정 (권한 문제 해결)
        window_duration: 180
        # 이 프로세서가 스팬 데이터를 분석하여 서비스 관계를 파악하는 핵심 역할을 합니다.
  sink:
    - opensearch:
        hosts:
          - "http://opensearch:9200"
        index: "otel-v1-apm-service-map"