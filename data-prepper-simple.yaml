log-pipeline:
  source:
    otel_logs_source:
      port: 21892
      ssl: false
      health_check_service: true

  sink:
    - opensearch:
        hosts:
          - "http://opensearch:9200"
        index: "logs-${getMetadata(\"service.name\")}"
        # 서비스 별로 인덱스 생성 (service.name 메타데이터 사용)
        insecure: true
        verify_ssl: false

trace-pipeline:
  source:
    otel_trace_source:
      port: 21890
      ssl: false
      health_check_service: true

  processor:
    - otel_traces:

  sink:
    - opensearch:
        hosts:
          - "http://opensearch:9200"
        index: "otel-v1-apm-span"
        index_type: trace-analytics-raw
        insecure: true
        verify_ssl: false
    - pipeline:
        name: "service-map-pipeline"

service-map-pipeline:
  source:
    pipeline:
      name: "trace-pipeline"

  processor:
    - service_map_stateful:
        window_duration: "PT3M"  # ISO 8601 duration format (3 minutes)

  sink:
    - opensearch:
        hosts:
          - "http://opensearch:9200"
        index: "otel-v1-apm-service-map"
        index_type: service-map
        insecure: true
        verify_ssl: false
